<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Plan-Trek — Planet Travel Guide</title>
  <style>
    :root{
      --bg0:#0a0e14;
      --bg1:#0f1724;
      --panel:#0e1624cc;
      --panel2:#0b1220cc;
      --stroke:#2f3a4d;
      --stroke2:#3b4a63;
      --gold1:#f6d77a;
      --gold2:#caa24a;
      --gold3:#8a6a22;
      --text:#e7edf7;
      --muted:#aab6c9;
      --accent:#76a5af;
      --danger:#ff6b6b;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --r1:18px;
      --r2:24px;
      --pad:18px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      color:var(--text);
      background:
        radial-gradient(900px 500px at 25% 10%, rgba(118,165,175,.18), transparent 60%),
        radial-gradient(900px 500px at 80% 20%, rgba(246,215,122,.12), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
    }
    .wrap{
      max-width: 1320px;
      margin: 0 auto;
      padding: 22px 18px 28px;
    }
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      padding: 16px 18px;
      border-radius: var(--r2);
      background: linear-gradient(180deg, rgba(15,23,36,.9), rgba(10,14,20,.7));
      border: 1px solid rgba(59,74,99,.7);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .brand{
      display:flex;
      flex-direction:column;
      gap:4px;
      min-width: 260px;
    }
    .brand .title{
      font-size: 26px;
      font-weight: 900;
      letter-spacing: .4px;
      background: linear-gradient(180deg, var(--gold1), var(--gold2));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 18px rgba(246,215,122,.18);
      line-height: 1.05;
    }
    .brand .sub{
      color: var(--muted);
      font-size: 13px;
    }
    .controls{
      display:flex;
      align-items:center;
      gap:10px;
      flex: 1;
      justify-content:flex-end;
      flex-wrap:wrap;
    }
    .pill{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 999px;
      background: linear-gradient(180deg, rgba(22,32,48,.92), rgba(12,18,32,.75));
      border: 1px solid rgba(59,74,99,.7);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
    }
    .pill input{
      width: min(420px, 55vw);
      background: transparent;
      border: 0;
      outline: none;
      color: var(--text);
      font-size: 14px;
    }
    .pill input::placeholder{color: rgba(170,182,201,.72)}
    .btn{
      border: 1px solid rgba(59,74,99,.75);
      background: linear-gradient(180deg, rgba(25,37,58,.95), rgba(12,18,32,.8));
      color: var(--text);
      padding: 10px 12px;
      border-radius: 999px;
      font-weight: 700;
      font-size: 13px;
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease, box-shadow .12s ease;
      box-shadow: 0 10px 26px rgba(0,0,0,.35);
    }
    .btn:hover{
      transform: translateY(-1px);
      border-color: rgba(246,215,122,.55);
      box-shadow: 0 18px 44px rgba(0,0,0,.5);
    }
    .btn:active{transform: translateY(0px) scale(.99)}
    .btn.secondary{
      background: linear-gradient(180deg, rgba(18,27,42,.95), rgba(12,18,32,.8));
      color: var(--muted);
    }

    .grid{
      display:grid;
      grid-template-columns: 420px 1fr;
      gap: 16px;
      margin-top: 16px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      .brand{min-width:unset}
      .controls{justify-content:flex-start}
      .pill input{width: min(520px, 80vw)}
    }

    .panel{
      border-radius: var(--r2);
      background: linear-gradient(180deg, rgba(18,27,42,.92), rgba(10,14,20,.78));
      border: 1px solid rgba(59,74,99,.7);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
    }
    .panelHeader{
      padding: 14px 16px 12px;
      border-bottom: 1px solid rgba(59,74,99,.45);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .panelHeader .h{
      font-weight: 900;
      letter-spacing:.35px;
      color: var(--text);
      font-size: 14px;
      text-transform: uppercase;
      opacity:.95;
    }
    .panelHeader .meta{
      color: var(--muted);
      font-size: 12px;
      white-space: nowrap;
    }
    .list{
      padding: 12px;
      display:grid;
      gap: 10px;
      max-height: calc(100vh - 210px);
      overflow:auto;
    }
    .list::-webkit-scrollbar{height:10px;width:10px}
    .list::-webkit-scrollbar-thumb{background: rgba(118,165,175,.22);border-radius:999px}
    .list::-webkit-scrollbar-track{background: rgba(255,255,255,.04);border-radius:999px}

    .card{
      border-radius: 18px;
      border: 1px solid rgba(59,74,99,.7);
      background: linear-gradient(180deg, rgba(10,18,34,.78), rgba(10,14,20,.65));
      box-shadow: 0 12px 28px rgba(0,0,0,.38);
      padding: 12px 12px 12px;
      display:flex;
      gap: 12px;
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease, box-shadow .12s ease;
    }
    .card:hover{
      transform: translateY(-1px);
      border-color: rgba(246,215,122,.5);
      box-shadow: 0 18px 44px rgba(0,0,0,.55);
    }
    .card.active{
      border-color: rgba(246,215,122,.75);
      box-shadow: 0 22px 60px rgba(0,0,0,.6);
    }
    .thumb{
      position:relative;
      width: 66px;
      height: 66px;
      border-radius: 16px;
      border: 1px solid rgba(59,74,99,.65);
      background:
        radial-gradient(60px 60px at 35% 35%, rgba(246,215,122,.22), transparent 60%),
        radial-gradient(70px 70px at 70% 60%, rgba(118,165,175,.18), transparent 62%),
        linear-gradient(180deg, rgba(25,37,58,.9), rgba(10,14,20,.8));
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      flex:0 0 auto;
    }
    .thumb img{width:100%;height:100%;object-fit:contain;object-position:center;display:block}
    .cardTitle{
      font-weight: 900;
      font-size: 15px;
      margin: 0;
      line-height: 1.2;
    }
    .cardSub{
      color: var(--muted);
      font-size: 12px;
      margin-top: 4px;
      line-height: 1.25;
    }
    .badgeRow{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top: 8px;
    }
    .badge{
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(59,74,99,.65);
      background: linear-gradient(180deg, rgba(12,18,32,.85), rgba(8,12,22,.75));
      color: rgba(231,237,247,.92);
      white-space: nowrap;
    }
    .badge.gold{
      border-color: rgba(246,215,122,.45);
      background: linear-gradient(180deg, rgba(246,215,122,.18), rgba(12,18,32,.75));
    }

    .detail{
      padding: 16px;
    }
    .hero{
      border-radius: 22px;
      border: 1px solid rgba(59,74,99,.65);
      background:
        radial-gradient(600px 250px at 15% 20%, rgba(246,215,122,.18), transparent 60%),
        radial-gradient(700px 260px at 80% 30%, rgba(118,165,175,.18), transparent 60%),
        linear-gradient(180deg, rgba(18,27,42,.88), rgba(10,14,20,.72));
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      padding: 16px;
      display:grid;
      grid-template-columns: 170px 1fr;
      gap: 14px;
      align-items: stretch;
    }
    @media (max-width: 700px){
      .hero{grid-template-columns:1fr}
      .heroImg{width:min(260px, 100%); margin: 0 auto}
    }
    .heroImg{
      border-radius: 18px;
      border: 1px solid rgba(59,74,99,.65);
      background:
        radial-gradient(100px 100px at 35% 35%, rgba(246,215,122,.20), transparent 60%),
        radial-gradient(140px 140px at 70% 60%, rgba(118,165,175,.18), transparent 62%),
        linear-gradient(180deg, rgba(25,37,58,.9), rgba(10,14,20,.8));
      overflow:hidden;
      position:relative;
      min-height: 170px;
      aspect-ratio: 1 / 1;
      align-self: start;
    }
    .heroImg img{width:100%;height:100%;object-fit:contain;object-position:center;display:block}
    .heroTitle{
      margin: 0 0 6px 0;
      font-size: 30px;
      font-weight: 950;
      letter-spacing:.25px;
      line-height: 1.05;
      background: linear-gradient(180deg, var(--gold1), var(--gold2));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 18px rgba(246,215,122,.14);
    }
    .heroAlt{
      color: rgba(170,182,201,.9);
      font-size: 13px;
      margin: 0 0 10px 0;
    }
    .heroBadges{margin-top: 8px; display:flex; flex-wrap:wrap; gap:6px;}
    .heroSummary{
      color: rgba(231,237,247,.95);
      font-size: 14px;
      line-height: 1.55;
      margin-top: 10px;
    }
    .sectionGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }
    @media (max-width: 980px){
      .sectionGrid{grid-template-columns:1fr}
    }
    .section{
      border-radius: 20px;
      border: 1px solid rgba(59,74,99,.65);
      background: linear-gradient(180deg, rgba(10,18,34,.72), rgba(10,14,20,.62));
      box-shadow: 0 14px 38px rgba(0,0,0,.45);
      overflow:hidden;
    }
    .sectionHead{
      padding: 12px 14px;
      border-bottom: 1px solid rgba(59,74,99,.4);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .sectionHead .name{
      font-weight: 900;
      letter-spacing:.25px;
      font-size: 13px;
      text-transform: uppercase;
      color: rgba(231,237,247,.95);
    }
    .sectionBody{
      padding: 12px 14px 14px;
      color: rgba(231,237,247,.94);
      font-size: 14px;
      line-height: 1.55;
    }
    .kv{
      display:grid;
      grid-template-columns: 150px 1fr;
      gap: 10px;
      padding: 8px 0;
      border-bottom: 1px dashed rgba(59,74,99,.35);
    }
    .kv:last-child{border-bottom:0}
    .k{color: rgba(170,182,201,.9); font-size: 12px; text-transform: uppercase; letter-spacing:.25px}
    .v{color: rgba(231,237,247,.95)}
    .ul{
      margin: 8px 0 0 0;
      padding-left: 18px;
    }
    .ul li{margin: 6px 0}
    .small{color: rgba(170,182,201,.92); font-size: 12px; line-height: 1.45}
    .empty{
      color: rgba(170,182,201,.86);
      font-size: 13px;
      line-height: 1.5;
      padding: 18px 14px;
    }
    .footerNote{
      margin-top: 14px;
      color: rgba(170,182,201,.82);
      font-size: 12px;
      padding: 0 6px;
    }
    a{color: var(--accent); text-decoration: none}
    a:hover{text-decoration: underline}
  </style>
<style id="mainConsoleNavStyle">
  #mainConsoleLink {
    position: fixed;
    top: 16px;
    left: 16px;
    z-index: 99999;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 10px 14px;
    border-radius: 12px;
    text-decoration: none;
    font-weight: 700;
    letter-spacing: 0.06em;
    font-size: 12px;
    border: 1px solid rgba(255, 255, 255, 0.25);
    background: rgba(20, 25, 35, 0.85);
    color: rgba(255, 255, 255, 0.92);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    box-shadow: 0 8px 18px rgba(0, 0, 0, 0.35);
    transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
  }
  #mainConsoleLink:hover {
    transform: translateY(-1px);
    box-shadow: 0 10px 22px rgba(0, 0, 0, 0.42);
    background: rgba(26, 33, 46, 0.9);
  }
  #mainConsoleLink:active {
    transform: translateY(0px);
    box-shadow: 0 8px 18px rgba(0, 0, 0, 0.35);
  }
</style>
</head>
<body>
  <a id="mainConsoleLink" href="https://bigbird7827.github.io/Main-Console/">MAIN CONSOLE</a>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="title">Plan‑Trek</div>
        <div class="sub">Planet Travel Guide Console</div>
      </div>

      <div class="controls">
        <div class="pill" title="Search planets">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="rgba(231,237,247,.85)" stroke-width="2"/>
            <path d="M16.5 16.5 21 21" stroke="rgba(231,237,247,.85)" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <input id="search" type="text" placeholder="Search: Earth, Vulcan…" autocomplete="off" />
        </div>
        <button class="btn secondary" id="reloadBtn">Reload</button>
        
      </div>
    </div>

    <div class="grid">
      <div class="panel">
        <div class="panelHeader">
          <div class="h">Planets</div>
          <div class="meta" id="countMeta">—</div>
        </div>
        <div class="list" id="planetList">
          <div class="empty">Loading…</div>
        </div>
      </div>

      <div class="panel">
        <div class="panelHeader">
          <div class="h">Detail</div>
          <div class="meta" id="buildMeta">—</div>
        </div>
        <div class="detail" id="detail">
          <div class="empty">Select a planet to view travel details.</div>
        </div>
      </div>
    </div>
  </div>
  <script>
const DATA_URLS = [
  "https://raw.githubusercontent.com/BigBird7827/Pla-Trek/main/Planets.json"
];

const els = {
  list: document.getElementById("planetList"),
  detail: document.getElementById("detail"),
  search: document.getElementById("search"),
  countMeta: document.getElementById("countMeta"),
  buildMeta: document.getElementById("buildMeta"),
  reloadBtn: document.getElementById("reloadBtn")
};

let rawData = null;
let planets = [];
let filtered = [];
let selectedId = null;

const IMG_NORM = {
  fillThumb: 0.89,
  fillHero: 0.89,
  alphaThreshold: 12
};

function normalizeAllIn(root){
  if (!root) return;
  root.querySelectorAll(".thumb img, .heroImg img").forEach(img => normalizeWhenReady(img));
}

function normalizeWhenReady(img){
  if (!img) return;

  const run = () => {
    if (!document.contains(img)) return;
    if (!img.complete || !img.naturalWidth) return;
    normalizeImageToContent(img);
    img.dataset.norm = "1";
  };

  if (img.complete && img.naturalWidth){
    requestAnimationFrame(run);
  } else {
    img.addEventListener("load", () => requestAnimationFrame(run), { once: true });
  }
}

function normalizeImageToContent(img){
  const frame = img.closest(".thumb, .heroImg");
  if (!frame) return;

  const r = frame.getBoundingClientRect();
  const cw = Math.max(1, Math.round(r.width));
  const ch = Math.max(1, Math.round(r.height));

  const iw = img.naturalWidth;
  const ih = img.naturalHeight;
  if (!iw || !ih) return;

  const fill = frame.classList.contains("heroImg") ? IMG_NORM.fillHero : IMG_NORM.fillThumb;

  let bounds = null;

  try{
    const maxDim = 256;
    const down = Math.min(1, maxDim / Math.max(iw, ih));
    const w = Math.max(1, Math.round(iw * down));
    const h = Math.max(1, Math.round(ih * down));

    const canvas = document.createElement("canvas");
    canvas.width = w;
    canvas.height = h;

    const ctx = canvas.getContext("2d", { willReadFrequently: true });
    ctx.clearRect(0, 0, w, h);
    ctx.drawImage(img, 0, 0, w, h);

    const data = ctx.getImageData(0, 0, w, h).data;

    let minX = w, minY = h, maxX = -1, maxY = -1;
    const aThr = IMG_NORM.alphaThreshold;

    for (let y = 0; y < h; y++){
      for (let x = 0; x < w; x++){
        const i = (y * w + x) * 4;
        const a = data[i + 3];
        if (a > aThr){
          if (x < minX) minX = x;
          if (y < minY) minY = y;
          if (x > maxX) maxX = x;
          if (y > maxY) maxY = y;
        }
      }
    }

    if (maxX >= 0){
      const spanX = maxX - minX;
      const spanY = maxY - minY;
      const fullX = spanX >= (w - 2);
      const fullY = spanY >= (h - 2);

      if (fullX && fullY){
        const c1 = 0;
        const c2 = (w - 1) * 4;
        const c3 = (h - 1) * w * 4;
        const c4 = ((h - 1) * w + (w - 1)) * 4;

        const br = Math.round((data[c1] + data[c2] + data[c3] + data[c4]) / 4);
        const bg = Math.round((data[c1 + 1] + data[c2 + 1] + data[c3 + 1] + data[c4 + 1]) / 4);
        const bb = Math.round((data[c1 + 2] + data[c2 + 2] + data[c3 + 2] + data[c4 + 2]) / 4);

        let minX2 = w, minY2 = h, maxX2 = -1, maxY2 = -1;
        const colorThr = 48;

        for (let y = 0; y < h; y++){
          for (let x = 0; x < w; x++){
            const i = (y * w + x) * 4;
            const dr = Math.abs(data[i] - br);
            const dg = Math.abs(data[i + 1] - bg);
            const db = Math.abs(data[i + 2] - bb);
            if ((dr + dg + db) > colorThr){
              if (x < minX2) minX2 = x;
              if (y < minY2) minY2 = y;
              if (x > maxX2) maxX2 = x;
              if (y > maxY2) maxY2 = y;
            }
          }
        }

        if (maxX2 >= 0){
          bounds = {
            minX: minX2 / down,
            minY: minY2 / down,
            maxX: (maxX2 + 1) / down,
            maxY: (maxY2 + 1) / down
          };
        }
      } else {
        bounds = {
          minX: minX / down,
          minY: minY / down,
          maxX: (maxX + 1) / down,
          maxY: (maxY + 1) / down
        };
      }
    }
  } catch (e){
    bounds = null;
  }

  if (!bounds){
    bounds = { minX: 0, minY: 0, maxX: iw, maxY: ih };
  }

  const bw = Math.max(1, bounds.maxX - bounds.minX);
  const bh = Math.max(1, bounds.maxY - bounds.minY);
  const cx = bounds.minX + bw / 2;
  const cy = bounds.minY + bh / 2;

  const target = fill * Math.min(cw, ch);
  const scale = target / Math.max(bw, bh);

  const tx = (cw / 2) - (cx * scale);
  const ty = (ch / 2) - (cy * scale);

  img.style.position = "absolute";
  img.style.left = "0";
  img.style.top = "0";
  img.style.width = iw + "px";
  img.style.height = ih + "px";
  img.style.maxWidth = "none";
  img.style.maxHeight = "none";
  img.style.transformOrigin = "0 0";
  img.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;
  img.style.display = "block";
}

let _normResizeT = null;
window.addEventListener("resize", () => {
  clearTimeout(_normResizeT);
  _normResizeT = setTimeout(() => {
    document.querySelectorAll(".thumb img[data-norm='1'], .heroImg img[data-norm='1']").forEach(img => {
      img.dataset.norm = "0";
      normalizeWhenReady(img);
    });
  }, 120);
});

function esc(s){
  return (s ?? "").toString().replace(/[&<>"']/g, (c) => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
  }[c]));
}

function br(s){
  const t = esc(s);
  return t ? t.replace(/\n/g, "<br>") : "";
}

function norm(s){
  return (s ?? "").toString().toLowerCase().trim();
}

function fetchJsonFirst(urls){
  return (async () => {
    let lastErr = null;
    for (const url of urls){
      try{
        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status);
        const j = await res.json();
        return { url, data: j };
      }catch(e){
        lastErr = e;
      }
    }
    throw lastErr || new Error("Unable to load data.");
  })();
}

function buildMetaText(data){
  const build = (data && (data.Build ?? (data.Meta && data.Meta.Build) ?? data.Version ?? (data.Meta && data.Meta.Version)));
  const schema = (data && (data.SchemaVersion ?? (data.Meta && data.Meta.SchemaVersion)));
  const updated = (data && (data.LastUpdated ?? (data.Meta && data.Meta.LastUpdated)));
  const bits = [];
  if (build !== undefined && build !== null && build !== "") bits.push("Build " + build);
  if (schema) bits.push("Schema " + schema);
  if (updated) bits.push(updated);
  return bits.length ? bits.join(" • ") : "—";
}

function buildCard(p){
  const alt = Array.isArray(p.AlternateNames) && p.AlternateNames.length ? p.AlternateNames.join(" • ") : "";
  const tags = Array.isArray(p.TypeTags) ? p.TypeTags : [];
  const subBits = [];
  if (p.Location && p.Location.StarSystem) subBits.push(p.Location.StarSystem);
  if (p.Location && p.Location.Sector) subBits.push(p.Location.Sector);
  if (p.Location && p.Location.Quadrant) subBits.push(p.Location.Quadrant);
  const sub = subBits.filter(Boolean).join(" • ");
  const imgUrl = p.Media && p.Media.HeroImageURL ? p.Media.HeroImageURL : null;

  const div = document.createElement("div");
  div.className = "card" + (p.PlanetID === selectedId ? " active" : "");
  div.dataset.id = p.PlanetID;

  const thumb = document.createElement("div");
  thumb.className = "thumb";
  if (imgUrl){
    const img = document.createElement("img");
    img.crossOrigin = "anonymous";
    img.src = imgUrl;
    img.alt = p.Name || "";
    thumb.appendChild(img);
  }
  div.appendChild(thumb);

  const info = document.createElement("div");
  info.style.minWidth = "0";

  const h = document.createElement("div");
  h.className = "cardTitle";
  h.textContent = p.Name || "Untitled";
  info.appendChild(h);

  const s = document.createElement("div");
  s.className = "cardSub";
  const line = [alt, sub].filter(Boolean).join(" — ");
  s.textContent = line || " ";
  info.appendChild(s);

  const brRow = document.createElement("div");
  brRow.className = "badgeRow";
  (tags.slice(0, 6)).forEach((t, idx) => {
    const b = document.createElement("div");
    b.className = "badge" + (idx === 0 ? " gold" : "");
    b.textContent = t;
    brRow.appendChild(b);
  });
  info.appendChild(brRow);

  div.appendChild(info);

  div.addEventListener("click", () => selectPlanet(p.PlanetID, true));
  return div;
}

function renderList(){
  els.list.innerHTML = "";
  if (!filtered.length){
    const empty = document.createElement("div");
    empty.className = "empty";
    empty.textContent = "No matches.";
    els.list.appendChild(empty);
  } else {
    filtered.forEach(p => els.list.appendChild(buildCard(p)));
  }
  els.countMeta.textContent = filtered.length + " / " + planets.length;
  normalizeAllIn(els.list);
}

function kvRow(k, vHtml){
  const row = document.createElement("div");
  row.className = "kv";
  const kk = document.createElement("div");
  kk.className = "k";
  kk.textContent = k;
  const vv = document.createElement("div");
  vv.className = "v";
  vv.innerHTML = (vHtml && vHtml.trim()) ? vHtml : "<span class='small'>—</span>";
  row.appendChild(kk);
  row.appendChild(vv);
  return row;
}

function ul(items, renderItem){
  const u = document.createElement("ul");
  u.className = "ul";
  items.forEach(it => {
    const li = document.createElement("li");
    li.innerHTML = renderItem ? renderItem(it) : esc(it);
    u.appendChild(li);
  });
  return u;
}

function section(name, bodyNode){
  const s = document.createElement("div");
  s.className = "section";
  const head = document.createElement("div");
  head.className = "sectionHead";
  const n = document.createElement("div");
  n.className = "name";
  n.textContent = name;
  head.appendChild(n);
  s.appendChild(head);
  const b = document.createElement("div");
  b.className = "sectionBody";
  b.appendChild(bodyNode);
  s.appendChild(b);
  return s;
}

function renderDetail(planet){
  els.detail.innerHTML = "";
  if (!planet){
    els.detail.innerHTML = "<div class='empty'>Select a planet.</div>";
    return;
  }

  const meta = planet.Meta || {};
  const loc = planet.Location || {};
  const media = planet.Media || {};
  const weather = planet.Weather || {};
  const history = planet.History || {};
  const gov = planet.Government || {};
  const econ = planet.Economy || {};
  const cult = planet.Culture || {};
  const env = planet.Environment || {};
  const canon = planet.CanonAppearances || {};
  const sites = Array.isArray(planet.CitiesAndSites) ? planet.CitiesAndSites : [];

  const hero = document.createElement("div");
  hero.className = "hero";

  const heroImg = document.createElement("div");
  heroImg.className = "heroImg";
  if (media.HeroImageURL){
    const img = document.createElement("img");
    img.crossOrigin = "anonymous";
    img.src = media.HeroImageURL;
    img.alt = planet.Name || "";
    heroImg.appendChild(img);
  }
  hero.appendChild(heroImg);

  const heroText = document.createElement("div");

  const h1 = document.createElement("h1");
  h1.className = "heroTitle";
  h1.textContent = planet.Name || "";
  heroText.appendChild(h1);

  const altLine = [];
  if (Array.isArray(planet.AlternateNames) && planet.AlternateNames.length) altLine.push(planet.AlternateNames.join(" • "));
  if (meta.CanonicalName && meta.CanonicalName !== planet.Name) altLine.push(meta.CanonicalName);
  const alt = document.createElement("div");
  alt.className = "heroAlt";
  alt.textContent = altLine.length ? altLine.join(" — ") : "";
  heroText.appendChild(alt);

  const badgeWrap = document.createElement("div");
  badgeWrap.className = "heroBadges";
  const tagList = Array.isArray(planet.Tags) ? planet.Tags : [];
  const typeTags = Array.isArray(planet.TypeTags) ? planet.TypeTags : [];
  const badges = [...typeTags.slice(0, 4), ...tagList.slice(0, 6)];
  if (badges.length){
    badges.forEach((t, idx) => {
      const b = document.createElement("div");
      b.className = "badge" + (idx === 0 ? " gold" : "");
      b.textContent = t;
      badgeWrap.appendChild(b);
    });
  }
  heroText.appendChild(badgeWrap);

  if (planet.TravelSummary){
    const sum = document.createElement("div");
    sum.className = "heroSummary";
    sum.innerHTML = br(planet.TravelSummary);
    heroText.appendChild(sum);
  }

  hero.appendChild(heroText);
  els.detail.appendChild(hero);

  const sectionGrid = document.createElement("div");
  sectionGrid.className = "sectionGrid";

  const overviewBody = document.createElement("div");
  overviewBody.appendChild(kvRow("Classification", esc(meta.Classification || "")));
  overviewBody.appendChild(kvRow("Affiliation", esc(meta.Affiliation || "")));
  overviewBody.appendChild(kvRow("Quadrant", esc(loc.Quadrant || "")));
  overviewBody.appendChild(kvRow("Sector", esc(loc.Sector || "")));
  overviewBody.appendChild(kvRow("Star system", esc(loc.StarSystem || "")));
  overviewBody.appendChild(kvRow("Region", esc(loc.Region || "")));
  if (Array.isArray(meta.NativeSpecies) && meta.NativeSpecies.length){
    overviewBody.appendChild(kvRow("Native species", esc(meta.NativeSpecies.join(" • "))));
  }
  sectionGrid.appendChild(section("Overview", overviewBody));

  const visitorBody = document.createElement("div");
  visitorBody.innerHTML = `
    <div class="small"><b>Tourism</b></div>
    <div>${br(planet.Tourism || "") || "<span class='small'>—</span>"}</div>
    <div style="height:10px"></div>
    <div class="small"><b>Logistics</b></div>
    <div>${br(planet.Logistics || "") || "<span class='small'>—</span>"}</div>
  `;
  sectionGrid.appendChild(section("Visitor notes", visitorBody));

  const weatherBody = document.createElement("div");
  weatherBody.appendChild(kvRow("Climate type", esc(weather.ClimateType || "")));
  weatherBody.appendChild(kvRow("Seasonality", esc(weather.Seasonality || "")));
  weatherBody.appendChild(kvRow("Typical conditions", esc(weather.TypicalConditions || "")));
  if (Array.isArray(weather.Hazards) && weather.Hazards.length){
    const wrap = document.createElement("div");
    wrap.appendChild(document.createElement("div"));
    const t = document.createElement("div");
    t.className = "small";
    t.style.marginTop = "10px";
    t.innerHTML = "<b>Hazards</b>";
    wrap.appendChild(t);
    wrap.appendChild(ul(weather.Hazards, x => br(x)));
    weatherBody.appendChild(wrap);
  }
  sectionGrid.appendChild(section("Weather", weatherBody));

  const peopleBody = document.createElement("div");
  peopleBody.innerHTML = br(planet.Inhabitants || "") || "<span class='small'>—</span>";
  sectionGrid.appendChild(section("Inhabitants", peopleBody));

  const appearanceBody = document.createElement("div");
  appearanceBody.innerHTML = br(planet.Appearance || "") || "<span class='small'>—</span>";
  sectionGrid.appendChild(section("Appearance", appearanceBody));

  const geoBody = document.createElement("div");
  geoBody.innerHTML = br(planet.Geography || "") || "<span class='small'>—</span>";
  if (Array.isArray(loc.NearbyLandmarks) && loc.NearbyLandmarks.length){
    const t = document.createElement("div");
    t.className = "small";
    t.style.marginTop = "10px";
    t.innerHTML = "<b>Nearby / landmarks</b>";
    geoBody.appendChild(t);
    geoBody.appendChild(ul(loc.NearbyLandmarks, x => br(x)));
  }
  sectionGrid.appendChild(section("Geography", geoBody));

  const historyBody = document.createElement("div");
  if (history.Overview){
    const p = document.createElement("div");
    p.innerHTML = br(history.Overview);
    historyBody.appendChild(p);
  }
  if (Array.isArray(history.KeyEras) && history.KeyEras.length){
    const t = document.createElement("div");
    t.className = "small";
    t.style.marginTop = "10px";
    t.innerHTML = "<b>Key eras</b>";
    historyBody.appendChild(t);
    historyBody.appendChild(ul(history.KeyEras, e => `<b>${esc(e.Era || "")}</b>${e.Summary ? " — " + br(e.Summary) : ""}`));
  }
  if (Array.isArray(history.MajorEvents) && history.MajorEvents.length){
    const t = document.createElement("div");
    t.className = "small";
    t.style.marginTop = "10px";
    t.innerHTML = "<b>Major events</b>";
    historyBody.appendChild(t);
    historyBody.appendChild(ul(history.MajorEvents, e => `${e.When ? "<b>" + esc(e.When) + "</b>: " : ""}${br(e.Event || "")}`));
  }
  sectionGrid.appendChild(section("History", historyBody));

  const govBody = document.createElement("div");
  govBody.appendChild(kvRow("Polity", esc(gov.Polity || "")));
  govBody.appendChild(kvRow("Capital", esc(gov.Capital || "")));
  if (Array.isArray(gov.Institutions) && gov.Institutions.length){
    const t = document.createElement("div");
    t.className = "small";
    t.style.marginTop = "10px";
    t.innerHTML = "<b>Institutions</b>";
    govBody.appendChild(t);
    govBody.appendChild(ul(gov.Institutions, x => br(x)));
  }
  if (Array.isArray(gov.LawsAffectingVisitors) && gov.LawsAffectingVisitors.length){
    const t = document.createElement("div");
    t.className = "small";
    t.style.marginTop = "10px";
    t.innerHTML = "<b>Visitor-impacting rules</b>";
    govBody.appendChild(t);
    govBody.appendChild(ul(gov.LawsAffectingVisitors, x => br(x)));
  }
  if (gov.Notes){
    const t = document.createElement("div");
    t.className = "small";
    t.style.marginTop = "10px";
    t.innerHTML = "<b>Notes</b>";
    govBody.appendChild(t);
    const p = document.createElement("div");
    p.innerHTML = br(gov.Notes);
    govBody.appendChild(p);
  }
  sectionGrid.appendChild(section("Government", govBody));

  const econBody = document.createElement("div");
  if (econ.Overview) {
    const p = document.createElement("div");
    p.innerHTML = br(econ.Overview);
    econBody.appendChild(p);
  }
  if (Array.isArray(econ.PrimaryIndustries) && econ.PrimaryIndustries.length){
    const t = document.createElement("div");
    t.className = "small";
    t.style.marginTop = "10px";
    t.innerHTML = "<b>Primary industries</b>";
    econBody.appendChild(t);
    econBody.appendChild(ul(econ.PrimaryIndustries, x => br(x)));
  }
  if (econ.TradeNotes){
    const t = document.createElement("div");
    t.className = "small";
    t.style.marginTop = "10px";
    t.innerHTML = "<b>Trade notes</b>";
    econBody.appendChild(t);
    const p = document.createElement("div");
    p.innerHTML = br(econ.TradeNotes);
    econBody.appendChild(p);
  }
  if (econ.LocalCommerceNotes){
    const t = document.createElement("div");
    t.className = "small";
    t.style.marginTop = "10px";
    t.innerHTML = "<b>Local commerce</b>";
    econBody.appendChild(t);
    const p = document.createElement("div");
    p.innerHTML = br(econ.LocalCommerceNotes);
    econBody.appendChild(p);
  }
  sectionGrid.appendChild(section("Economy", econBody));

  const cultBody = document.createElement("div");
  if (cult.Overview){
    const p = document.createElement("div");
    p.innerHTML = br(cult.Overview);
    cultBody.appendChild(p);
  }
  if (cult.SocialCustoms){
    const t = document.createElement("div");
    t.className = "small";
    t.style.marginTop = "10px";
    t.innerHTML = "<b>Social customs</b>";
    cultBody.appendChild(t);
    const p = document.createElement("div");
    p.innerHTML = br(cult.SocialCustoms);
    cultBody.appendChild(p);
  }
  if (cult.ReligiousLife){
    const t = document.createElement("div");
    t.className = "small";
    t.style.marginTop = "10px";
    t.innerHTML = "<b>Religious life</b>";
    cultBody.appendChild(t);
    const p = document.createElement("div");
    p.innerHTML = br(cult.ReligiousLife);
    cultBody.appendChild(p);
  }
  if (cult.Festivals){
    const t = document.createElement("div");
    t.className = "small";
    t.style.marginTop = "10px";
    t.innerHTML = "<b>Festivals</b>";
    cultBody.appendChild(t);
    const p = document.createElement("div");
    p.innerHTML = br(cult.Festivals);
    cultBody.appendChild(p);
  }
  if (cult.ArtsAndMedia){
    const t = document.createElement("div");
    t.className = "small";
    t.style.marginTop = "10px";
    t.innerHTML = "<b>Arts & media</b>";
    cultBody.appendChild(t);
    const p = document.createElement("div");
    p.innerHTML = br(cult.ArtsAndMedia);
    cultBody.appendChild(p);
  }
  if (cult.LanguageNotes){
    const t = document.createElement("div");
    t.className = "small";
    t.style.marginTop = "10px";
    t.innerHTML = "<b>Language</b>";
    cultBody.appendChild(t);
    const p = document.createElement("div");
    p.innerHTML = br(cult.LanguageNotes);
    cultBody.appendChild(p);
  }
  sectionGrid.appendChild(section("Culture", cultBody));

  const envBody = document.createElement("div");
  if (env.Overview){
    const p = document.createElement("div");
    p.innerHTML = br(env.Overview);
    envBody.appendChild(p);
  }
  if (env.Seasons){
    const t = document.createElement("div");
    t.className = "small";
    t.style.marginTop = "10px";
    t.innerHTML = "<b>Seasons</b>";
    envBody.appendChild(t);
    const p = document.createElement("div");
    p.innerHTML = br(env.Seasons);
    envBody.appendChild(p);
  }
  if (Array.isArray(env.NaturalHazards) && env.NaturalHazards.length){
    const t = document.createElement("div");
    t.className = "small";
    t.style.marginTop = "10px";
    t.innerHTML = "<b>Natural hazards</b>";
    envBody.appendChild(t);
    envBody.appendChild(ul(env.NaturalHazards, x => br(x)));
  }
  if (env.NightSky){
    const t = document.createElement("div");
    t.className = "small";
    t.style.marginTop = "10px";
    t.innerHTML = "<b>Night sky</b>";
    envBody.appendChild(t);
    const p = document.createElement("div");
    p.innerHTML = br(env.NightSky);
    envBody.appendChild(p);
  }
  sectionGrid.appendChild(section("Environment", envBody));

  const placesBody = document.createElement("div");
  if (sites.length){
    placesBody.appendChild(ul(sites, s => `<b>${esc(s.Name || "")}</b>${s.Type ? ` <span class="small">(${esc(s.Type)})</span>` : ""}${s.Description ? `<div class="small" style="margin-top:4px">${br(s.Description)}</div>` : ""}`));
  } else {
    placesBody.innerHTML = "<span class='small'>—</span>";
  }
  sectionGrid.appendChild(section("Places & sites", placesBody));

  const canonBody = document.createElement("div");
  if (Array.isArray(canon.Episodes) && canon.Episodes.length){
    const t = document.createElement("div");
    t.className = "small";
    t.innerHTML = "<b>Episodes</b>";
    canonBody.appendChild(t);
    canonBody.appendChild(ul(canon.Episodes, x => br(x)));
  } else {
    canonBody.appendChild(kvRow("Episodes", ""));
  }
  if (Array.isArray(canon.Films) && canon.Films.length){
    const t = document.createElement("div");
    t.className = "small";
    t.style.marginTop = "10px";
    t.innerHTML = "<b>Films</b>";
    canonBody.appendChild(t);
    canonBody.appendChild(ul(canon.Films, x => br(x)));
  } else {
    canonBody.appendChild(kvRow("Films", ""));
  }
  if (canon.Notes){
    const t = document.createElement("div");
    t.className = "small";
    t.style.marginTop = "10px";
    t.innerHTML = "<b>Notes</b>";
    canonBody.appendChild(t);
    const p = document.createElement("div");
    p.innerHTML = br(canon.Notes);
    canonBody.appendChild(p);
  }
  sectionGrid.appendChild(section("Canon appearances", canonBody));
  els.detail.appendChild(sectionGrid);

  const foot = document.createElement("div");
  foot.className = "footerNote";
  foot.textContent = "Data source: " + (rawData && rawData.SchemaVersion ? ("Schema " + rawData.SchemaVersion) : "Planets.json");
  els.detail.appendChild(foot);

  normalizeAllIn(els.detail);

  window.scrollTo({ top: 0, behavior: "smooth" });
}

function selectPlanet(id, scrollIntoView){
  selectedId = id;
  const p = planets.find(x => x.PlanetID === id);
  renderList();
  if (!p){
    els.detail.innerHTML = "<div class='empty'>Planet not found.</div>";
    return;
  }
  renderDetail(p);
  if (scrollIntoView){
    const el = els.list.querySelector('[data-id="' + CSS.escape(id) + '"]');
    if (el) el.scrollIntoView({ block: "nearest" });
  }
}

function applyFilter(){
  const q = norm(els.search.value);
  if (!q){
    filtered = planets.slice();
  } else {
    filtered = planets.filter(p => {
      const hay = [
        p.Name,
        ...(Array.isArray(p.AlternateNames) ? p.AlternateNames : []),
        ...(Array.isArray(p.Tags) ? p.Tags : []),
        ...(Array.isArray(p.TypeTags) ? p.TypeTags : []),
        p.Location && p.Location.StarSystem ? p.Location.StarSystem : "",
        p.Location && p.Location.Sector ? p.Location.Sector : "",
        p.Location && p.Location.Quadrant ? p.Location.Quadrant : "",
        p.Location && p.Location.Region ? p.Location.Region : ""
      ].join(" ").toLowerCase();
      return hay.includes(q);
    });
  }
  if (selectedId && !filtered.some(p => p.PlanetID === selectedId)){
    selectedId = filtered.length ? filtered[0].PlanetID : null;
  }
  renderList();
  if (selectedId) renderDetail(planets.find(x => x.PlanetID === selectedId));
}

function showLoadError(){
  els.list.innerHTML =
    "<div class='empty'><b style='color: rgba(255,107,107,.95)'>Failed to load Planets.json.</b>" +
    "<div class='small' style='margin-top:8px'>Check the GitHub raw URL in <b>DATA_URLS</b> or your network connection.</div></div>";
  els.detail.innerHTML = "<div class='empty'>No data loaded.</div>";
  els.countMeta.textContent = "—";
  els.buildMeta.textContent = "—";
}

async function init(){
  try{
    els.list.innerHTML = "<div class='empty'>Loading…</div>";
    const { data } = await fetchJsonFirst(DATA_URLS);
    rawData = data;

    // Accept multiple JSON shapes:
// 1) { Planets: [...] }  (preferred)
// 2) [...]              (array of planet objects)
// 3) { PlanetID: ... }  (single planet object)
let planetArr = [];
if (data && Array.isArray(data.Planets)) {
  planetArr = data.Planets;
} else if (Array.isArray(data)) {
  planetArr = data;
} else if (data && typeof data === "object" && (data.PlanetID || data.Name)) {
  planetArr = [data];
}
planets = planetArr.slice();
    planets.sort((a,b) => (a.Name || "").localeCompare(b.Name || ""));
    filtered = planets.slice();

    els.buildMeta.textContent = buildMetaText(data);
    renderList();

    const first = planets.length ? planets[0].PlanetID : null;
    if (first){
      selectedId = first;
      renderList();
      renderDetail(planets.find(x => x.PlanetID === selectedId));
    } else {
      els.detail.innerHTML = "<div class='empty'>No planets found in data.</div>";
    }
  }catch(e){
    showLoadError();
  }
}

els.search.addEventListener("input", applyFilter);
els.reloadBtn.addEventListener("click", () => init());
init();
</script>
</body>
</html>
